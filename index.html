<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Photobook Collage Vintage</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- Google Fonts + Bootstrap 5 (CDN) -->
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f4f3e9; font-family: 'Montserrat', Arial, sans-serif; }
    .collage-container {
      background: #fffbe7;
      border-radius: 16px;
      padding: 24px 10px 18px 10px;
      max-width: 420px;
      margin: 36px auto 16px auto;
      box-shadow: 0 8px 36px #a6846022, 0 1.5px 6px #0001;
      position: relative;
      min-height: 580px;
    }
    .frame-layout {
      display: flex; flex-wrap: wrap; gap: 10px;
      justify-content: center;
      align-items: center;
      margin-bottom: 10px;
      min-height: 260px;
    }
    .frame1 > .img-wrap { width: 100%; height: 260px; }
    .frame2 > .img-wrap { width: 49%; height: 260px; }
    .frame3 > .img-wrap { width: 64%; height: 140px; }
    .frame3 > .img-wrap:nth-child(2), .frame3 > .img-wrap:nth-child(3) { width: 32%; height: 140px; }
    .frame4 > .img-wrap { width: 49%; height: 125px; }
    .img-wrap {
      background: #f8f6e7;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 1.5px 8px #a6846011;
      border: 2px solid #f3eaca;
      position: relative;
      aspect-ratio: 1/1;
      display: flex;
      align-items: center; justify-content: center;
      transition: border 0.2s;
      cursor: pointer;
    }
    .img-wrap.selected { border: 2.5px solid #cdb4db; }
    .img-wrap img {
      max-width: 100%; max-height: 100%; object-fit: cover;
      background: #eee;
      border-radius: 8px;
      transition: filter 0.3s;
    }
    .img-upload { opacity: 0; position: absolute; left:0; top:0; width:100%; height:100%; cursor:pointer; }
    .caption-text {
      font-family: 'Pacifico', cursive;
      color: #cdb4db;
      font-size: 1.2em;
      background: #fff7;
      border-radius: 8px;
      position: absolute;
      left: 16px; bottom: 8px; right: 16px;
      padding: 2px 6px 2px 8px;
      border: none;
      outline: none;
      pointer-events: auto;
    }
    .sticker-item {
      position: absolute; width: 48px; height: 48px;
      cursor: move; z-index: 10;
      transition: transform 0.13s;
    }
    .sticker-item img{ width:100%;height:100%; }
    .toolbar {
      text-align: center;
      margin-bottom: 10px;
      margin-top: 6px;
    }
    .toolbar button, .toolbar select {
      margin: 2px 4px;
    }
    .sticker-list {
      display:flex;gap:6px;justify-content:center;
      margin:8px 0 4px 0;
      flex-wrap: wrap;
    }
    .sticker-list img {
      width:36px; height:36px; border-radius:5px; background:#fffbe7;
      border:1.5px solid #ffe6fa; cursor:pointer;
      box-shadow:0 1px 5px #a6846012;
      transition:transform 0.1s;
    }
    .sticker-list img:hover { transform:scale(1.15);}
    .frame-select {
      border-radius:7px; background:#cdb4db22; border:1.5px solid #b6adc6;
      padding:4px 7px;font-weight:500;
    }
    .vintage { filter: sepia(0.18) saturate(1.2) brightness(1.07) contrast(0.93); }
    .pastel { filter: saturate(1.14) brightness(1.09) hue-rotate(12deg); }
    .retro { filter: sepia(.27) hue-rotate(-8deg) contrast(1.09); }
    .none { filter:none; }
    .btn-main {
      background:linear-gradient(90deg,#cdb4db,#ffe6fa);
      color:#7c517d;font-weight:600;border:none;
      border-radius:9px;box-shadow:0 1px 5px #a6846011;
      padding:7px 26px;font-size:1.09em;
      margin:0 7px 0 0;
    }
    .btn-main:hover { background:linear-gradient(90deg,#ffe6fa,#b5ead7); }
    .footer {
      text-align:center;font-size:0.96em;color:#9e9e9e;margin-bottom:8px;
      letter-spacing:0.02em;
    }
    @media (max-width:560px){
      .collage-container{max-width:99vw;padding:8px;}
      .img-wrap{min-width:90px;min-height:90px;}
    }
  </style>
</head>
<body>
  <div class="collage-container position-relative shadow">
    <div class="toolbar">
      <select id="frameSel" class="frame-select">
        <option value="frame3">Bố cục: 3 ảnh nghệ thuật</option>
        <option value="frame4">Bố cục: 4 ảnh đều</option>
        <option value="frame2">Bố cục: 2 ảnh lớn</option>
        <option value="frame1">1 ảnh lớn</option>
      </select>
      <select id="filterSel" class="frame-select">
        <option value="none">Màu gốc</option>
        <option value="vintage">Vintage</option>
        <option value="pastel">Pastel</option>
        <option value="retro">Retro</option>
      </select>
      <button class="btn btn-main" id="saveBtn">Tải Photobook</button>
    </div>
    <div id="frameArea" class="frame-layout frame3"></div>
    <div class="sticker-list">
      <img src="https://cdn.jsdelivr.net/gh/phusiucute/image-assets@main/sticker-heart.png" title="Tim xinh">
      <img src="https://cdn.jsdelivr.net/gh/phusiucute/image-assets@main/sticker-star.png" title="Sao">
      <img src="https://cdn.jsdelivr.net/gh/phusiucute/image-assets@main/sticker-camera.png" title="Máy ảnh">
      <img src="https://cdn.jsdelivr.net/gh/phusiucute/image-assets@main/sticker-flower.png" title="Hoa">
      <img src="https://cdn.jsdelivr.net/gh/phusiucute/image-assets@main/sticker-film.png" title="Film">
      <img src="https://cdn.jsdelivr.net/gh/phusiucute/image-assets@main/sticker-bear.png" title="Gấu">
      <img src="https://cdn.jsdelivr.net/gh/phusiucute/image-assets@main/sticker-couple.png" title="Couple">
    </div>
    <div class="footer mt-1">
      <span style="font-family:Pacifico,cursive;font-size:1.14em;color:#b5838d;">Photobook Art Collage</span>
      <br>
      Ghép ảnh, thêm caption, sticker xinh, tải về đăng Instagram!<br>
      <span style="font-size:0.94em;">by <a href="https://github.com/phusiucute" target="_blank">phusiucute</a></span>
    </div>
  </div>
  <!-- html2canvas để render thành ảnh -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    // --------- Frame Layouts ---------
    const layouts = {
      frame1: 1, frame2:2, frame3:3, frame4:4
    };
    let curFrame = "frame3", curFilter = "none";
    let images = [null, null, null, null], captions=["","","",""];
    // --------- Render Frames ---------
    function renderFrame(){
      const n = layouts[curFrame];
      const frame = document.getElementById("frameArea");
      frame.className = `frame-layout ${curFrame}`;
      frame.innerHTML = "";
      for(let i=0;i<n;i++){
        const wrap = document.createElement("div");
        wrap.className = "img-wrap";
        if(selectedIdx===i) wrap.classList.add("selected");
        // Ảnh
        let img = document.createElement("img");
        img.style.display = images[i]? "block":"none";
        if(images[i]) img.src = images[i];
        img.className = curFilter;
        img.ondblclick = ()=>editCaption(i);
        wrap.appendChild(img);
        // input upload
        let input = document.createElement("input");
        input.type = "file";
        input.accept = "image/*";
        input.className = "img-upload";
        input.onchange = e=>{
          const f = e.target.files[0];
          if(f){
            const reader = new FileReader();
            reader.onload = ev=>{
              images[i]=ev.target.result;
              renderFrame();
            };
            reader.readAsDataURL(f);
          }
        };
        wrap.appendChild(input);
        // Caption nhỏ
        let cap = document.createElement("div");
        cap.className = "caption-text";
        cap.textContent = captions[i]||"";
        cap.style.display = captions[i]? "block":"none";
        cap.onclick = ()=>editCaption(i);
        wrap.appendChild(cap);
        // Click để chọn frame
        wrap.onclick = ()=>{ selectedIdx=i; renderFrame(); };
        frame.appendChild(wrap);
      }
      // Hiện sticker
      stickers.forEach(s=>{
        if(s.frame===curFrame){
          let st = document.createElement("div");
          st.className = "sticker-item";
          st.style.left = s.x+"px";
          st.style.top = s.y+"px";
          st.style.transform = `scale(${s.scale||1}) rotate(${s.rotate||0}deg)`;
          st.innerHTML = `<img src="${s.src}">`;
          st.draggable = false;
          st.onmousedown = function(e){
            draggingSticker = s;
            dragOffset = [e.offsetX,e.offsetY];
          };
          st.ondblclick = ()=>{ //Xóa
            stickers = stickers.filter(ss=>ss!==s);
            renderFrame();
          };
          frame.appendChild(st);
        }
      });
    }
    // --------- Caption ---------
    function editCaption(idx){
      const txt = prompt("Nhập caption cho ảnh này:", captions[idx]||"");
      if(txt!==null) { captions[idx]=txt; renderFrame(); }
    }
    // --------- Sticker ---------
    let stickers = [];
    let draggingSticker = null, dragOffset=[0,0];
    document.querySelectorAll('.sticker-list img').forEach(img=>{
      img.onclick = function(){
        stickers.push({src:this.src, x:40,y:220,frame:curFrame,scale:1,rotate:0});
        renderFrame();
      }
    });
    document.addEventListener('mousemove',e=>{
      if(draggingSticker){
        draggingSticker.x = e.pageX - document.getElementById("frameArea").offsetLeft - dragOffset[0];
        draggingSticker.y = e.pageY - document.getElementById("frameArea").offsetTop - dragOffset[1];
        renderFrame();
      }
    });
    document.addEventListener('mouseup',()=>draggingSticker=null);
    // --------- Frame & Filter Changer ---------
    document.getElementById("frameSel").onchange = function(){
      curFrame=this.value; selectedIdx=0; renderFrame();
    };
    document.getElementById("filterSel").onchange = function(){
      curFilter=this.value; renderFrame();
    };
    // --------- Save Image ---------
    document.getElementById("saveBtn").onclick = function(){
      html2canvas(document.querySelector('.frame-layout'),{backgroundColor:null}).then(canvas=>{
        const url = canvas.toDataURL("image/png");
        const a = document.createElement("a");
        a.href = url; a.download = "photobook.png";
        a.click();
      });
    };
    // --------- Select ---------
    let selectedIdx = 0;
    // --------- Init ---------
    renderFrame();
  </script>
</body>
</html>
